<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="slide_contents01.css">
    </head>
    <body>
        <section class="header">
            <h1>スライドコンテンツサンプル</h1>
        </section>
        <div class="HSL01-container">
            <div class="HSL01-body">
<table id="HSL01-body-table">
    <thead>
        <tr>
            <th>No</th>
            <th>作業名</th>
            <th>担当</th>
            <th>工数</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1</td>
            <td>要件定義</td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>2</td>
            <td>外部設計</td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>4</td>
            <td>製造・単体テスト</td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>4-1</td>
            <td>クライアント</td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>4-1-1</td>
            <td>ログイン画面</td>
            <td>TKC-A</td>
            <td>24</td>
        </tr>
        <tr>
            <td>4-2</td>
            <td>サーバ</td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>4-2-1</td>
            <td>グイン処理</td>
            <td>IWA-A</td>
            <td>16</td>
        </tr>
    </tbody>
</table>
            </div>
            <div class="HSL01-slide-container">
                <div class="HSL01-slide-body">
                    <div class="HSL01-slide-page-body">
                        <div class="HSL01-slide-page01 HSL01-slide-page-hidden">
<h3>メンバー</h3>
<div class="HSL01-slide-page01-add-member">
    <img src="icon003_plus.png" alt="メンバー追加">
</div>
<ul>
    <li><p class="title">会社名</p><p class="title">氏名</p><p class="title">表示名</p></li>
    <li data-member_id="1"><p>(株)グッドワン</p><p>小池 修</p><p>GONE</p></li>
    <li data-member_id="2"><p>(株)ＴＫＣ</p><p>石崎 裕未</p><p>TKC-A</p></li>
    <li data-member_id="3"><p>(株)アイワ</p><p>川村 雅人</p><p>IWA-A</p></li>
    <li data-member_id="4"><p>(株)アイワ</p><p>松村 和豊</p><p>IWA-B</p></li>
</ul>
                        </div>
                    </div>
                    <div class="HSL01-slide-page-body">
                        <div class="HSL01-slide-page02 HSL01-slide-page-hidden">
<h3>作業項目</h3>
<ul>
    <li><img src="icon004_arrow_right.png" class="HSL01-list-icon">要件定義</li>
    <li><img src="icon004_arrow_right.png" class="HSL01-list-icon">外部設計</li>
    <li><img src="icon004_arrow_right.png" class="HSL01-list-icon">内部設計</li>
    <li><img src="icon004_arrow_right.png" class="HSL01-list-icon">製造・単体テスト</li>
    <li><img src="icon004_arrow_right.png" class="HSL01-list-icon">結合テスト</li>
    <li><img src="icon004_arrow_right.png" class="HSL01-list-icon">システムテスト</li>
    <li><img src="icon004_arrow_right.png" class="HSL01-list-icon">運用テスト</li>
    <li><img src="icon004_arrow_right.png" class="HSL01-list-icon">システム移行</li>
    <li><img src="icon004_arrow_right.png" class="HSL01-list-icon">運用・保守</li>
</ul>
                        </div>
                    </div>
                    <div class="HSL01-slide-page-body">
                        <div class="HSL01-slide-page03 HSL01-slide-page-hidden">
<h3>カレンダー設定</h3>
<div>
    <label for="start-date">開始日付：</label>
    <input type="date" id="start-date" name="start-date"/>
</div>
<div>
    <input type="checkbox" id="start-first-date" name="start-first-date" checked/>
    <label for="start-first-date">月初日から表示</label>
</div>
<div>
    <label for="date-period">期間：</label>
    <select id="date-period" name="date-period">
        <option value="1" selected>１ヶ月</option>
        <option value="2">２ヶ月</option>
        <option value="3">３ヶ月</option>
    </select>
</div>
                        </div>
                    </div>
                </div>
                <div class="HSL01-slide-tag">
                    <img src="icon001_person_team.png" class="HSL01-slide-page01-tag" alt="メンバー">
                    <img src="icon002_items.png" class="HSL01-slide-page02-tag" alt="作業項目">
                    <img src="icon006_calendar.png" class="HSL01-slide-page03-tag" alt="カレンダー">
                </div>
            </div>
        </div>
        <script>
/**
 * カレンダークラス
 */
class HSL01_Calender {
    /**
     * 指定日付の月末日を取得する.
     */
    getLastDate(thisDate) {
        return new Date(thisDate.getFullYear(), thisDate.getMonth() + 1, 0);
    }
    makeDayList(today, isStart1stDay) {
        const lastDate = this.getLastDate(today);      // 月末の日付
        const firstDate = isStart1stDay ? 1 : today.getDate();
        let dayWork = new Date(today.getFullYear(), today.getMonth(), firstDate);
        const dayList = [];
        while (dayWork <= lastDate) {
            dayList.push(new Date(dayWork.getTime()));
            dayWork.setDate(dayWork.getDate() + 1);
        }
        return dayList;
    }
    /**
     * カレンダー情報を作成する.
     * 2022
     *      11  1 - 30
     *      12  1 - 31
     * 2023
     *      1   1 - 31
     *      2   1 - 28
     */
    getCalenderList(fromDate, isStart1stDay, numberOfMonth) {
        const calender = [];
        let monthList = null;
        let flag = isStart1stDay;
        let now = new Date(fromDate.getFullYear(), fromDate.getMonth(), fromDate.getDate());
        for (let monthCount = 0; monthCount < numberOfMonth; ++monthCount) {
            if (!monthList) monthList = [];
            monthList.push(this.makeDayList(now, flag));
            var nextMonth = fromDate.getMonth() + 1;
            if (nextMonth < 12) {
                now = new Date(now.getFullYear(), nextMonth, 1);
            } else {
                calender.push(monthList);
                now = new Date(now.getFullYear() + 1, 1, 1);
            }
            flag = false;
        }
        if (monthList && !calender.includes(monthList)) calender.push(monthList);
        return calender;
    }
}

function HSL01_init_getWorkItems() {
    let items = [];
    // 作業項目の一覧を取得
    try {
        let tags = document.getElementsByClassName('HSL01-slide-page02');
        if (tags.length !==1) throw 'HSL01-slide-page02 class not found !';
        tags = tags.item(0).getElementsByTagName('ul');
        if (tags.length !==1) throw 'list tag not found !';
        tags = tags.item(0).getElementsByTagName('li');
        if (tags.length === 0) throw '作業項目が未設定です.';
        for (var liTag of tags) {
            items.push(liTag.textContent);
        }
    } catch (ex) {
        alert(ex);
    } finally {
        return items;
    }
}

function clearTableBody(element) {
    let tags = element.getElementsByTagName('tbody');
    let tbody = tags.item(0);
    const trs = tbody.getElementsByTagName('tr');
    for (let index = trs.length-1; index >= 0; --index) {
        tbody.deleteRow(trs[index]);
    }
}

function HSL01_init_calender() {
    try {
        let tag = document.getElementById('start-date');
        if (!tag) throw 'start-date input tag not found !';
        const today = new Date();
        tag.valueAsDate = today;

        tag = document.getElementById('start-first-date');
        if (!tag) throw 'start-first-date input tag not found !';
        const start1stDate = tag.checked;

        tag = document.getElementById('date-period');
        if (!tag) throw 'date-period input tag not found !';
        const numberOfMonth = tag.options[tag.selectedIndex].value;

        const calender = new HSL01_Calender();
        const calenderData = calender.getCalenderList(today, start1stDate, numberOfMonth);
        console.log(calenderData);
        return calenderData;
    } catch (ex) {
        alert(ex);
        return [];
    }
}

function HSL01_init_calender_header(table, calenderData) {
    try {
        let tag = table.tHead;
        if (!tag) throw 'no table header !';
        const trs = table.tHead.getElementsByTagName('tr');
        if (trs.length !== 1) throw 'table header not selected records !';
        const threc = trs[0];
        for (let index = threc.cells.length-1; index >= 4; --index) {
            threc.deleteCell(index);
        }
        for (let monthList of calenderData) {
            for (let month of monthList) {
                for (let date of month) {
                    let cellElem = document.createElement('th');
                    let dayOfWeek = date.getDay();
                    if (dayOfWeek === 0) {
                        cellElem.classList.add('HSL01-calender-sun');
                    } else if (dayOfWeek === 6) {
                        cellElem.classList.add('HSL01-calender-sta');
                    }
                    cellElem.appendChild(document.createTextNode(date.getDate()));
                    threc.appendChild(cellElem);
                }
            }
        }
        
    } catch (ex) {
        alert(ex);
    }
}

function HSL01_init_body() {
    const calenderData = HSL01_init_calender();

    const table = document.getElementById('HSL01-body-table');
    if (!table) {
        alert('HSL01-body-table id not found !');
        return;
    }
    clearTableBody(table);
    HSL01_init_calender_header(table, calenderData);
    let workItemList = HSL01_init_getWorkItems();
    if (workItemList.length < 1) return;
    //alert(workItemList);
    let no = 1;
    for (const item of workItemList) {
        // tbody要素にtr要素（行）を最後に追加
        var trElem = table.tBodies[0].insertRow(-1);
        var cellIndex = 0;
        // td要素(No)を追加
        var cellElem = trElem.insertCell(cellIndex++);
        // td要素(No)にテキストを追加
        cellElem.appendChild(document.createTextNode(no++));
        // td要素(作業名)を追加
        var cellElem = trElem.insertCell(cellIndex++);
        // td要素(作業名)にテキストを追加
        cellElem.appendChild(document.createTextNode(item));
    }
}

function HSL01_show_slide_body() {
    let els = document.getElementsByClassName('HSL01-slide-body');
    if (els.length !== 1) {
        console.error('no found slide body');
        return;
    }
    let c = els[0];
    c.style.display = 'block';
}
function HSL01_clear_active_tag() {
    let els = document.getElementsByClassName('HSL01-slide-tag');
    if (els.length !== 1) {
        console.error('no found slide tag container');
        return;
    }
    els = els[0].getElementsByTagName('img');
    if (els.length === 0) {
        console.error('no found slide tag');
    }
    for (let index = 0; index < els.length; ++index) {
        let imgTag = els[index];
        const iter = imgTag.classList.values();
        for (let v = iter.next(); !v.done; v = iter.next()) {
            if (v.value.match(/-tag-active$/)) {
                imgTag.classList.remove(v.value);
                break;
            }
        }
    }
}
function HSL01_hide_page() {
    let els = document.getElementsByClassName('HSL01-slide-page-body');
    if (els.length < 1) {
        console.error('no found slide tag page body');
        return;
    }
    for (let index = 0; index < els.length; ++index) {
        let pageTag = els[index].firstElementChild;
        if (!pageTag.classList.contains('HSL01-slide-page-hidden')) {
            pageTag.classList.add('HSL01-slide-page-hidden');
        }
    }
}
function HSL01_show_page(className) {
    let els = document.getElementsByClassName(className);
    if (els.length !== 1) {
        console.error('no found slide page(' + className + ')');
        return;
    }
    let c = els[0];
    c.classList.remove('HSL01-slide-page-hidden');
}
function HSL01_do_slide(className, inOut) {
    let els = document.getElementsByClassName('HSL01-slide-container');
    if (els.length !== 1) {
        console.error('no found slide container');
        return;
    }
    let c = els[0];
    let rmList = [];
    c.classList.forEach(clsName => {
        if (clsName.match(/-slidein$|-slideout$/)) {
            rmList.push(clsName);
        }
    });
    c.classList.remove(...rmList);
    c.classList.add(className + '-slide' + inOut);
}
function HSL01_is_page_actice(target) {
    const iter = target.classList.values();
    for (let v = iter.next(); !v.done; v = iter.next()) {
        if (v.value.match(/-tag-active$/)) {
            return true;
        }
    }
    return false;
}
function HSL01_clickEvent(event) {
    let target = event.target;
    let slidePage = '';
    if (target.classList.contains('HSL01-slide-page01-tag')) {
        slidePage = 'HSL01-slide-page01';
    } else if (target.classList.contains('HSL01-slide-page02-tag')) {
        slidePage = 'HSL01-slide-page02';
    } else if (target.classList.contains('HSL01-slide-page03-tag')) {
        slidePage = 'HSL01-slide-page03';
    }
    if (slidePage) {
        if (HSL01_is_page_actice(target)) {
            HSL01_hide_page();
            HSL01_clear_active_tag();
            HSL01_do_slide(slidePage, 'out');
        } else {
            HSL01_show_slide_body();
            HSL01_hide_page();
            HSL01_clear_active_tag();
            HSL01_show_page(slidePage);
            HSL01_do_slide(slidePage, 'in');
            target.classList.add(slidePage + '-tag-active');
        }
    }
}
window.addEventListener('load', (event) => {
    console.log('start content slider sample');
    HSL01_init_body();
    document.addEventListener('click', HSL01_clickEvent);
});
        </script>
    </body>
</html>