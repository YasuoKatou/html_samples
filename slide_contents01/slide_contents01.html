<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="slide_contents01.css">
    </head>
    <body>
        <section class="header">
            <h1>スライドコンテンツサンプル</h1>
        </section>
        <div class="HSL01-container">
            <div class="HSL01-body">
<ul class="HSL01-body-table HSL01-body-table-header">
    <li>
        <ul class="HSL01-body-table-header-title">
            <li><p>No</p></li>
            <li><p>作業名</p></li>
            <li><p>担当</p></li>
            <li><p>工数</p></li>
        </ul>
    </li>
    <li>
        <ul class="HSL01-body-table-header-date">
            <li><p>1</p></li>
            <li><p>2</p></li>
            <li><p>3</p></li>
            <li><p>4</p></li>
            <li><p>5</p></li>
            <li><p>6</p></li>
            <li><p>7</p></li>
            <li><p>8</p></li>
            <li><p>9</p></li>
            <li><p>10</p></li>
        </ul>
    </li>
</ul>
<ul class="HSL01-body-table HSL01-body-table-body">
    <li class="HSL01-body-table-body-contents">
        <ul>
            <li><p>1</p></li>
            <li><p>要件定義</p></li>
            <li><p></p></li>
            <li><p></p></li>
        </ul>
        <ul>
            <li><p>2</p></li>
            <li><p>外部設計</p></li>
            <li><p></p></li>
            <li><p></p></li>
        </ul>
        <ul>
            <li><p>4</p></li>
            <li><p>製造・単体テスト</p></li>
            <li><p></p></li>
            <li><p></p></li>
        </ul>
        <ul>
            <li><p>4-1</p></li>
            <li><p>クライアント</p></li>
            <li><p></p></li>
            <li><p></p></li>
        </ul>
        <ul>
            <li><p>4-1-1</p></li>
            <li><p>ログイン画面</p></li>
            <li><p>TKC-A</p></li>
            <li><p>24</p></li>
        </ul>
        <ul>
            <li><p>4-2</p></li>
            <li><p>サーバ</p></li>
            <li><p></p></li>
            <li><p></p></li>
        </ul>
        <ul>
            <li><p>4-1-1</p></li>
            <li><p>ログイン処理</p></li>
            <li><p>IWA-A</p></li>
            <li><p>16</p></li>
        </ul>
    </li>
    <li class="HSL01-body-table-body-contents">
        <ul class="HSL01-body-table-body-date">

        </ul>
    </li>
</ul>
            </div>
            <div class="HSL01-slide-container">
                <div class="HSL01-slide-body">
                    <div class="HSL01-slide-page-body">
                        <div class="HSL01-slide-page01 HSL01-slide-page-hidden">
<h3>メンバー</h3>
<div class="HSL01-slide-page01-add-member">
    <img src="icon003_plus.png" alt="メンバー追加">
</div>
<ul>
    <li><p class="title">会社名</p><p class="title">氏名</p><p class="title">表示名</p></li>
    <li data-member_id="1"><p>(株)グッドワン</p><p>小池 修</p><p>GONE</p></li>
    <li data-member_id="2"><p>(株)ＴＫＣ</p><p>石崎 裕未</p><p>TKC-A</p></li>
    <li data-member_id="3"><p>(株)アイワ</p><p>川村 雅人</p><p>IWA-A</p></li>
    <li data-member_id="4"><p>(株)アイワ</p><p>松村 和豊</p><p>IWA-B</p></li>
</ul>
                        </div>
                    </div>
                    <div class="HSL01-slide-page-body">
                        <div class="HSL01-slide-page02 HSL01-slide-page-hidden">
<h3>作業項目</h3>
<ul>
    <li><img src="icon004_arrow_right.png" class="HSL01-list-icon">要件定義</li>
    <li><img src="icon004_arrow_right.png" class="HSL01-list-icon">外部設計</li>
    <li><img src="icon004_arrow_right.png" class="HSL01-list-icon">内部設計</li>
    <li><img src="icon004_arrow_right.png" class="HSL01-list-icon">製造・単体テスト</li>
    <li><img src="icon004_arrow_right.png" class="HSL01-list-icon">結合テスト</li>
    <li><img src="icon004_arrow_right.png" class="HSL01-list-icon">システムテスト</li>
    <li><img src="icon004_arrow_right.png" class="HSL01-list-icon">運用テスト</li>
    <li><img src="icon004_arrow_right.png" class="HSL01-list-icon">システム移行</li>
    <li><img src="icon004_arrow_right.png" class="HSL01-list-icon">運用・保守</li>
</ul>
                        </div>
                    </div>
                    <div class="HSL01-slide-page-body">
                        <div class="HSL01-slide-page03 HSL01-slide-page-hidden">
<h3>カレンダー設定</h3>
<div>
    <label for="start-date">開始日付：</label>
    <input type="date" id="start-date" name="start-date"/>
</div>
<div>
    <input type="checkbox" id="start-first-date" name="start-first-date" checked/>
    <label for="start-first-date">月初日から表示</label>
</div>
<div>
    <label for="date-period">期間：</label>
    <select id="date-period" name="date-period">
        <option value="1" selected>１ヶ月</option>
        <option value="2">２ヶ月</option>
        <option value="3">３ヶ月</option>
    </select>
</div>
                        </div>
                    </div>
                </div>
                <div class="HSL01-slide-tag">
                    <img src="icon001_person_team.png" class="HSL01-slide-page01-tag" alt="メンバー">
                    <img src="icon002_items.png" class="HSL01-slide-page02-tag" alt="作業項目">
                    <img src="icon006_calendar.png" class="HSL01-slide-page03-tag" alt="カレンダー">
                </div>
            </div>
        </div>
        <script>
/**
 * カレンダークラス
 */
class HSL01_Calender {
    /**
     * 指定日付の月末日を取得する.
     */
    getLastDate(thisDate) {
        return new Date(thisDate.getFullYear(), thisDate.getMonth() + 1, 0);
    }
    makeDayList(today, isStart1stDay) {
        const lastDate = this.getLastDate(today);      // 月末の日付
        const firstDate = isStart1stDay ? 1 : today.getDate();
        let dayWork = new Date(today.getFullYear(), today.getMonth(), firstDate);
        const dayList = [];
        while (dayWork <= lastDate) {
            dayList.push(new Date(dayWork.getTime()));
            dayWork.setDate(dayWork.getDate() + 1);
        }
        return dayList;
    }
    /**
     * カレンダー情報を作成する.
     * 2022
     *      11  1 - 30
     *      12  1 - 31
     * 2023
     *      1   1 - 31
     *      2   1 - 28
     */
    getCalenderList(fromDate, isStart1stDay, numberOfMonth) {
        const calender = [];
        let monthList = null;
        let flag = isStart1stDay;
        let now = new Date(fromDate.getFullYear(), fromDate.getMonth(), fromDate.getDate());
        for (let monthCount = 0; monthCount < numberOfMonth; ++monthCount) {
            if (!monthList) monthList = [];
            monthList.push(this.makeDayList(now, flag));
            var nextMonth = fromDate.getMonth() + 1;
            if (nextMonth < 12) {
                now = new Date(now.getFullYear(), nextMonth, 1);
            } else {
                calender.push(monthList);
                now = new Date(now.getFullYear() + 1, 1, 1);
            }
            flag = false;
        }
        if (monthList && !calender.includes(monthList)) calender.push(monthList);
        return calender;
    }
}

function HSL01_init_getWorkItems() {
    let items = [];
    // 作業項目の一覧を取得
    try {
        let tags = document.getElementsByClassName('HSL01-slide-page02');
        if (tags.length !==1) throw 'HSL01-slide-page02 class not found !';
        tags = tags.item(0).getElementsByTagName('ul');
        if (tags.length !==1) throw 'list tag not found !';
        tags = tags.item(0).getElementsByTagName('li');
        if (tags.length === 0) throw '作業項目が未設定です.';
        for (var liTag of tags) {
            items.push(liTag.textContent);
        }
    } catch (ex) {
        alert(ex);
    } finally {
        return items;
    }
}

function clearTableBody(element) {
    try {
        let tags = document.getElementsByClassName('HSL01-body-table-body');
        if (tags.length !== 1) throw 'not selected body !'
        tags = tags.item(0).getElementsByClassName('HSL01-body-table-body-contents')
        if (tags.length !== 2) throw 'not selected title and date in body !'
        for (let index = 0; index < tags.length; ++index) {
            let tbody = tags.item(index);
            while (tbody.firstChild) {
                tbody.removeChild(tbody.firstChild);
            }
        }
    } catch (ex) {
        alert(ex);
    }
}

function HSL01_init_calender() {
    try {
        let tag = document.getElementById('start-date');
        if (!tag) throw 'start-date input tag not found !';
        const today = new Date();
        tag.valueAsDate = today;

        tag = document.getElementById('start-first-date');
        if (!tag) throw 'start-first-date input tag not found !';
        const start1stDate = tag.checked;

        tag = document.getElementById('date-period');
        if (!tag) throw 'date-period input tag not found !';
        const numberOfMonth = tag.options[tag.selectedIndex].value;

        const calender = new HSL01_Calender();
        const calenderData = calender.getCalenderList(today, start1stDate, numberOfMonth);
        //console.log(calenderData);
        return calenderData;
    } catch (ex) {
        alert(ex);
        return [];
    }
}

function HSL01_init_calender_header(calenderData) {
    try {
        let tags = document.getElementsByClassName('HSL01-body-table-header-date');
        if (tags.length !== 1) throw 'not selected calender header !';
        const headerCalender = tags.item(0);
        while (headerCalender.firstChild) {
            headerCalender.removeChild(headerCalender.firstChild);
        }
        for (let monthList of calenderData) {
            for (let month of monthList) {
                for (let date of month) {
                    let p = document.createElement('p');
                    p.appendChild(document.createTextNode(date.getDate()));
                    let li = document.createElement('li');
                    li.appendChild(p);
                    let dayOfWeek = date.getDay();
                    if (dayOfWeek === 0) {
                        p.classList.add('HSL01-calender-sun');
                    } else if (dayOfWeek === 6) {
                        p.classList.add('HSL01-calender-sat');
                    }
                    headerCalender.appendChild(li);
                }
            }
        }
    } catch (ex) {
        alert(ex);
    }
}

function HSL01_table_contents_title(data) {
    let p = document.createElement('p');
    p.appendChild(document.createTextNode(data));
    let li = document.createElement('li');
    li.appendChild(p);
    return li;
}

function HSL01_init_table_contents() {
    try {
        let tags = document.getElementsByClassName('HSL01-body-table-body');
        if (tags.length !== 1) throw 'not selected body !'
        tags = tags.item(0).getElementsByClassName('HSL01-body-table-body-contents')
        if (tags.length !== 2) throw 'not selected title and date in body !'
        let title = tags.item(0);
        let workItemList = HSL01_init_getWorkItems();
        if (workItemList.length < 1) return;
        // console.log(workItemList);
        let no = 1;
        for (const item of workItemList) {
            let ul = document.createElement('ul');

            ul.appendChild(HSL01_table_contents_title(no++));
            ul.appendChild(HSL01_table_contents_title(item));
            ul.appendChild(HSL01_table_contents_title(''));
            ul.appendChild(HSL01_table_contents_title(''));

            title.appendChild(ul);
        }

        let date = tags.item(0);
        // TODO
    } catch (ex) {
        alert(ex);
    }
}

function HSL01_init_body() {
    clearTableBody();
    HSL01_init_table_contents();
    const calenderData = HSL01_init_calender();
    HSL01_init_calender_header(calenderData);
}

function HSL01_show_slide_body() {
    let els = document.getElementsByClassName('HSL01-slide-body');
    if (els.length !== 1) {
        console.error('no found slide body');
        return;
    }
    let c = els[0];
    c.style.display = 'block';
}
function HSL01_clear_active_tag() {
    let els = document.getElementsByClassName('HSL01-slide-tag');
    if (els.length !== 1) {
        console.error('no found slide tag container');
        return;
    }
    els = els[0].getElementsByTagName('img');
    if (els.length === 0) {
        console.error('no found slide tag');
    }
    for (let index = 0; index < els.length; ++index) {
        let imgTag = els[index];
        const iter = imgTag.classList.values();
        for (let v = iter.next(); !v.done; v = iter.next()) {
            if (v.value.match(/-tag-active$/)) {
                imgTag.classList.remove(v.value);
                break;
            }
        }
    }
}
function HSL01_hide_page() {
    let els = document.getElementsByClassName('HSL01-slide-page-body');
    if (els.length < 1) {
        console.error('no found slide tag page body');
        return;
    }
    for (let index = 0; index < els.length; ++index) {
        let pageTag = els[index].firstElementChild;
        if (!pageTag.classList.contains('HSL01-slide-page-hidden')) {
            pageTag.classList.add('HSL01-slide-page-hidden');
        }
    }
}
function HSL01_show_page(className) {
    let els = document.getElementsByClassName(className);
    if (els.length !== 1) {
        console.error('no found slide page(' + className + ')');
        return;
    }
    let c = els[0];
    c.classList.remove('HSL01-slide-page-hidden');
}
function HSL01_do_slide(className, inOut) {
    let els = document.getElementsByClassName('HSL01-slide-container');
    if (els.length !== 1) {
        console.error('no found slide container');
        return;
    }
    let c = els[0];
    let rmList = [];
    c.classList.forEach(clsName => {
        if (clsName.match(/-slidein$|-slideout$/)) {
            rmList.push(clsName);
        }
    });
    c.classList.remove(...rmList);
    c.classList.add(className + '-slide' + inOut);
}
function HSL01_is_page_actice(target) {
    const iter = target.classList.values();
    for (let v = iter.next(); !v.done; v = iter.next()) {
        if (v.value.match(/-tag-active$/)) {
            return true;
        }
    }
    return false;
}
function HSL01_clickEvent(event) {
    let target = event.target;
    let slidePage = '';
    if (target.classList.contains('HSL01-slide-page01-tag')) {
        slidePage = 'HSL01-slide-page01';
    } else if (target.classList.contains('HSL01-slide-page02-tag')) {
        slidePage = 'HSL01-slide-page02';
    } else if (target.classList.contains('HSL01-slide-page03-tag')) {
        slidePage = 'HSL01-slide-page03';
    }
    if (slidePage) {
        if (HSL01_is_page_actice(target)) {
            HSL01_hide_page();
            HSL01_clear_active_tag();
            HSL01_do_slide(slidePage, 'out');
        } else {
            HSL01_show_slide_body();
            HSL01_hide_page();
            HSL01_clear_active_tag();
            HSL01_show_page(slidePage);
            HSL01_do_slide(slidePage, 'in');
            target.classList.add(slidePage + '-tag-active');
        }
    }
}
window.addEventListener('load', (event) => {
    //console.log('start content slider sample');
    HSL01_init_body();
    document.addEventListener('click', HSL01_clickEvent);
});
        </script>
    </body>
</html>